import{j as e,g as k,r as x,u as w,M as N,h as y,b as D}from"./index-b129b865.js";import{G as S,S as G}from"./utils-e871904b.js";import{B as J}from"./Form-94e33b9f.js";import{M as P}from"./ModalButton-4f99a517.js";import{M as C}from"./Modal-e7822c47.js";import{J as B}from"./JournalSelect-a0a0e0d6.js";import{P as L}from"./Paginator-54973130.js";import{u as $}from"./useDispatch-6201ab63.js";import"./config-a5b38a07.js";import"./Grow-c0f8e368.js";import"./bootstrap.bundle.min-69815fb9.js";function I({lessons:r}){return e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:2}),e.jsx("th",{colSpan:r.length,className:"text-center",children:"Даты"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Фамилия, имя"}),r.map(a=>e.jsx("th",{children:e.jsx("div",{className:"m-auto text-center",children:`${new Date(a.date_val).getDate()<10?"0":""}${new Date(a.date_val).getDate()}`})},a.id))]})]})}function E({grade:r,lessons:a,onMarkChange:o}){function l(n,i){const d=n.marks.find(h=>h.student_id===i.id);return d?d.mark_value:""}return e.jsx("tbody",{children:r.map((n,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:i+1}),e.jsxs("td",{style:{width:"15%"},children:[n.surname," ",n.name[0],"."]}),a.map(d=>e.jsx("td",{className:"m-0 p-0",children:e.jsx(J,{simple:!0,additionalClasses:"text-center invisible-input border-0",onInput:h=>{o(n.id,d.id,h.currentTarget.value)},value:l(d,n)})},d.id))]},n.id))})}function T({lessons:r}){function a(o){const l=new Date(o),n=l.getMonth()+1,i=l.getDate();return`${i>9?i:"0"+i}.${n>9?n:"0"+n}`}return e.jsx("table",{className:"table table-bordered table-striped",children:e.jsx("tbody",{children:r.map((o,l)=>e.jsxs("tr",{children:[e.jsx("td",{style:{verticalAlign:"middle"},children:a(o.date_val)}),e.jsx("td",{children:o.theme.name})]},l))})})}function W(){const r=k(),[a,o]=x.useState([]),[l,n]=x.useState(0),[i,d]=x.useState([]),h=$(),b=w();x.useEffect(()=>{S({id:Number(r.journal_id)}).then(t=>{o(t.lessons),d(t.grade.sort((s,m)=>s.surname.localeCompare(m.surname)))})},[r.journal_id]);function v(t,s,m){const c=a,u=c.findIndex(_=>_.id===s),g=c[u].marks.findIndex(_=>_.student_id===t);let f;g===-1?(c[u].marks.push({student_id:t,mark_value:m,lesson_id:s}),f=c[u].marks[c[u].marks.length-1]):(c[u].marks[g].mark_value=m,f=c[u].marks[g]),G({mark:f}).then(()=>{}),o(c)}function M(t){t.length==0?h(D({type:"danger",text:"Нет журнала для этого класса и предмета"})):b(`/journal/${t[0].id}`)}function p(){const t=[];for(let s=0;s<a.length;s++){const m=new Date(a[s].date_val);t.push(m.getMonth())}return Array.from(new Set(t))}function j(){let t=p()[l];return a.filter(s=>new Date(s.date_val).getMonth()===t)}return e.jsxs(e.Fragment,{children:[e.jsx(C,{connected_with:"select_journal_modal",title:"Выбор журнала",children:e.jsx(B,{GetJournal:M})}),e.jsx(P,{connected_with:"select_journal_modal",additionalClasses:"m-3",button_text:"Выбор журнала"}),a.length>0?e.jsxs("div",{className:"row m-0 p-0",children:[e.jsxs("div",{className:"col-lg-10 col-12",children:[e.jsx(L,{max_page:p().length-1,current_page:l,onPageChange:t=>{n(t)},custom_page_names:p().map(t=>N(t))}),e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx(I,{lessons:j()}),e.jsx(E,{grade:i,lessons:j(),onMarkChange:v})]})]}),e.jsx("div",{className:"col-2 overflow-auto d-none d-lg-block",style:{maxHeight:"80vh"},children:e.jsx(T,{lessons:j()})})]}):e.jsx(y,{})]})}export{W as default};
